<!DOCTYPE html>
<html lang="sq">
<head>
    <meta charset="UTF-8">
    <title>K√´rkim sipas Let√´rnjoftimit | Google Sheets</title>
    <style>
        * {
            box-sizing: border-box;
        }
        body {
            font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
            margin: 0;
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            background: linear-gradient(135deg, #0f172a, #1e293b, #0f766e);
            color: #e5e7eb;
        }
        .app {
            background: rgba(15, 23, 42, 0.9);
            border-radius: 18px;
            padding: 24px 22px 20px;
            width: 100%;
            max-width: 520px;
            box-shadow:
                0 20px 40px rgba(0,0,0,0.45),
                0 0 0 1px rgba(148,163,184,0.2);
        }
        .header {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 10px;
        }
        .header-text h1 {
            margin: 0;
            font-size: 18px;
            font-weight: 600;
        }
        .header-text p {
            margin: 2px 0 0;
            font-size: 12px;
            color: #9ca3af;
        }
        .icon-circle {
            width: 34px;
            height: 34px;
            border-radius: 999px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: radial-gradient(circle at 30% 20%, #22d3ee, #0ea5e9, #0369a1);
            box-shadow: 0 0 0 1px rgba(15,23,42,0.8);
            font-weight: 700;
            font-size: 18px;
            margin-bottom: 6px;
        }
        .search-row {
            display: flex;
            gap: 8px;
            margin-top: 4px;
        }
        .search-row input {
            flex: 1;
            border-radius: 10px;
            border: 1px solid rgba(148,163,184,0.5);
            background: rgba(15,23,42,0.8);
            padding: 8px 10px;
            color: #e5e7eb;
            outline: none;
            font-size: 14px;
        }
        .search-row input:focus {
            border-color: #22d3ee;
            box-shadow: 0 0 0 1px rgba(34,211,238,0.3);
        }
        .search-row button {
            border-radius: 10px;
            border: none;
            padding: 8px 14px;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            background: linear-gradient(135deg, #22c55e, #16a34a);
            color: white;
            white-space: nowrap;
            display: inline-flex;
            align-items: center;
            gap: 6px;
        }
        .search-row button:hover {
            filter: brightness(1.07);
        }
        .hint {
            margin-top: 6px;
            font-size: 11px;
            color: #9ca3af;
        }
        #result {
            margin-top: 18px;
        }
        .card {
            background: rgba(15,23,42,0.9);
            border-radius: 14px;
            padding: 14px 14px 10px;
            border: 1px solid rgba(55,65,81,0.9);
            box-shadow: 0 10px 25px rgba(0,0,0,0.35);
        }
        .card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 8px;
        }
        .card-title {
            font-size: 14px;
            font-weight: 600;
        }
        .card-tag {
            font-size: 11px;
            padding: 3px 8px;
            border-radius: 999px;
            background: rgba(34,197,94,0.12);
            color: #bbf7d0;
            border: 1px solid rgba(34,197,94,0.3);
        }
        .card-main {
            display: grid;
            grid-template-columns: 1.1fr 1.1fr;
            gap: 8px 16px;
            font-size: 12px;
        }
        .field-label {
            font-size: 11px;
            color: #9ca3af;
        }
        .field-value {
            font-size: 13px;
            font-weight: 500;
            color: #e5e7eb;
        }
        .table-wrap {
            margin-top: 12px;
            max-height: 240px;
            overflow: auto;
        }
        table {
            border-collapse: collapse;
            width: 100%;
            font-size: 11px;
        }
        th, td {
            border: 1px solid #374151;
            padding: 5px 6px;
            text-align: left;
        }
        th {
            background-color: #111827;
            position: sticky;
            top: 0;
            z-index: 1;
        }
        .actions {
            margin-top: 15px;
            display: flex;
            gap: 10px;
        }
        .btn-print {
            padding: 8px 14px;
            border: none;
            border-radius: 8px;
            background: #0ea5e9;
            color: white;
            cursor: pointer;
            font-size: 13px;
            display: inline-flex;
            align-items: center;
            gap: 6px;
        }
        .btn-reset {
            padding: 8px 14px;
            border: none;
            border-radius: 8px;
            background: #ef4444;
            color: white;
            cursor: pointer;
            font-size: 13px;
            display: inline-flex;
            align-items: center;
            gap: 6px;
        }
        .btn-print:hover {
            filter: brightness(1.07);
        }
        .btn-reset:hover {
            filter: brightness(1.08);
        }
        .error {
            margin-top: 10px;
            color: #fecaca;
            background: rgba(127,29,29,0.6);
            border-radius: 10px;
            padding: 8px 10px;
            font-size: 12px;
            border: 1px solid rgba(248,113,113,0.5);
        }
        .loading {
            margin-top: 10px;
            font-size: 12px;
            color: #93c5fd;
        }
        .no-print {
            /* vet√´m p√´r @media print */
        }

        @media (max-width: 540px) {
            .app {
                margin: 16px;
                padding: 18px 16px;
            }
            .card-main {
                grid-template-columns: 1fr;
            }
        }

        /* Stil p√´r printim ‚Äì t√´ dal√´ past√´r */
        @media print {
            body {
                background: #ffffff !important;
            }
            .app {
                box-shadow: none !important;
                background: #ffffff !important;
                color: #000000 !important;
                max-width: 100%;
                border-radius: 0;
                padding: 10px 10px 0;
            }
            .no-print {
                display: none !important;
            }
            .card {
                background: #ffffff !important;
                border-color: #00000033;
                box-shadow: none !important;
            }
            table, th, td {
                border-color: #00000055;
            }
        }
    </style>
</head>
<body>

<div class="app">
    <!-- Header -->
    <div class="header">
        <img src="https://upload.wikimedia.org/wikipedia/commons/1/1f/Coat_of_arms_of_Kosovo.svg"
             alt="Kosova"
             style="width:48px; height:48px; margin-right:4px;">
        <div class="header-text">
            <h1>Republika e Kosov√´s</h1>
            <p>Sistem k√´rkimi sipas numrit t√´ let√´rnjoftimit</p>
        </div>
    </div>

    <div class="icon-circle no-print">ID</div>

    <!-- Zona e k√´rkimit -->
    <div class="search-row no-print">
        <input
            type="text"
            id="idInput"
            placeholder="Shkruaj numrin e let√´rnjoftimit p.sh. 1000021799"
            autocomplete="off"
        >
        <button id="searchBtn">
            üîç K√´rko
        </button>
    </div>
    <div class="hint no-print">
        Shtyp Enter ose ‚ÄúK√´rko‚Äù pasi t√´ shkruash numrin e let√´rnjoftimit (kolona B: Leternjoftimi).
    </div>

    <div id="result"></div>
</div>

<script>
    // Linku i RI i publikuar CSV nga Google Sheets
    const CSV_URL =
        "https://docs.google.com/spreadsheets/d/e/2PACX-1vTSMBzjWZIZfNUD0bPlfi6VvhncQ3l1R469dZ1jgYBdrcn5LRW_5_No6p_HBmL1z7gNzestszsUkyd_/pub?gid=1793407122&single=true&output=csv";

    // Leternjoftimi √´sht√´ n√´ kolon√´n B => indeks 1 (A=0, B=1, ...)
    const ID_COLUMN_INDEX = 1;

    let sheetData = [];
    let header = [];

    async function loadData() {
        const resultDiv = document.getElementById("result");
        resultDiv.innerHTML = "<div class='loading'>Duke lexuar t√´ dh√´nat nga Google Sheets...</div>";

        const response = await fetch(CSV_URL);
        if (!response.ok) {
            throw new Error("Nuk u lexua Google Sheet. Kontrollo q√´ linku CSV hapet normalisht n√´ browser.");
        }

        const text = await response.text();
        const rows = text.split(/\r?\n/).filter(r => r.trim() !== "");
        sheetData = rows.map(row => row.split(","));
        header = sheetData[0];
        resultDiv.innerHTML = "";
    }

    function findById(id) {
        id = id.trim();
        for (let i = 1; i < sheetData.length; i++) {
            if (sheetData[i][ID_COLUMN_INDEX] === id) {
                return sheetData[i];
            }
        }
        return null;
    }

    function display(row) {
        const div = document.getElementById("result");
        div.innerHTML = "";

        if (!row) {
            div.innerHTML =
                "<div class='error'>Nuk u gjet asnj√´ rresht p√´r k√´t√´ num√´r let√´rnjoftimi. Kontrollo sakt√´sin√´.</div>";
            return;
        }

        // Mappimi sipas kolonave t√´ reja:
        // A KodiLandes, B Leternjoftimi, C EEmri, D DataLindjes,
        // E DataAplikimit, F Komenti, G Skema, H Rajoni, I LajmerimiFundit
        const kodiLandes       = row[0] ?? "";
        const leternjoftimi    = row[1] ?? "";
        const eEmri            = row[2] ?? "";
        const dataLindjes      = row[3] ?? "";
        const dataAplikimit    = row[4] ?? "";
        const komenti          = row[5] ?? "";
        const skema            = row[6] ?? "";
        const rajoni           = row[7] ?? "";
        const lajmerimiFundit  = row[8] ?? "";

        let html = `<div class="card">
            <div class="card-header">
                <div class="card-title">
                    Rezultati p√´r let√´rnjoftimin: <strong>${leternjoftimi}</strong>
                </div>
                <div class="card-tag">${skema || "Skema"}</div>
            </div>
            <div class="card-main">
                <div>
                    <div class="field-label">Emri dhe mbiemri</div>
                    <div class="field-value">${eEmri || "-"}</div>
                </div>
                <div>
                    <div class="field-label">Kodi Landes</div>
                    <div class="field-value">${kodiLandes || "-"}</div>
                </div>
                <div>
                    <div class="field-label">Data lindjes</div>
                    <div class="field-value">${dataLindjes || "-"}</div>
                </div>
                <div>
                    <div class="field-label">Data aplikimit</div>
                    <div class="field-value">${dataAplikimit || "-"}</div>
                </div>
                <div>
                    <div class="field-label">Rajoni</div>
                    <div class="field-value">${rajoni || "-"}</div>
                </div>
                <div>
                    <div class="field-label">Lajm√´rimi i fundit</div>
                    <div class="field-value">${lajmerimiFundit || "-"}</div>
                </div>
                <div style="grid-column: 1 / -1;">
                    <div class="field-label">Komenti</div>
                    <div class="field-value">${komenti || "-"}</div>
                </div>
            </div>
            <div class="table-wrap">
                <table>
                    <thead>
                        <tr>`;

        for (let i = 0; i < header.length; i++) {
            html += `<th>${header[i] ?? ("Kolona " + (i + 1))}</th>`;
        }

        html += `        </tr>
                    </thead>
                    <tbody>
                        <tr>`;

        for (let i = 0; i < header.length; i++) {
            html += `<td>${row[i] ?? ""}</td>`;
        }

        html += `       </tr>
                    </tbody>
                </table>
            </div>
            <div class="actions no-print">
                <button class="btn-print" onclick="window.print()">
                    üñ®Ô∏è Print
                </button>
                <button class="btn-reset" onclick="resetSearch()">
                    ‚Ü©Ô∏è Kthehu te k√´rkimi
                </button>
            </div>
        </div>`;

        div.innerHTML = html;
    }

    async function handleSearch() {
        const id = document.getElementById("idInput").value;
        const resultDiv = document.getElementById("result");

        if (!id.trim()) {
            resultDiv.innerHTML =
                "<div class='error'>Shkruaj nj√´ num√´r let√´rnjoftimi s√´ pari.</div>";
            return;
        }

        try {
            if (sheetData.length === 0) {
                await loadData();
            }
        } catch (e) {
            resultDiv.innerHTML = `<div class='error'>${e.message}</div>`;
            return;
        }

        const row = findById(id);
        display(row);
    }

    function resetSearch() {
        document.getElementById("idInput").value = "";
        document.getElementById("result").innerHTML = "";
        document.getElementById("idInput").focus();
    }

    document.getElementById("searchBtn").addEventListener("click", handleSearch);
    document.getElementById("idInput").addEventListener("keydown", (e) => {
        if (e.key === "Enter") {
            handleSearch();
        }
    });
</script>

</body>
</html>
